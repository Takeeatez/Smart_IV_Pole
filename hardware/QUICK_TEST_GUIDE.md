# 빠른 테스트 가이드 (Quick Test Guide)

## 🚀 업로드 및 기본 테스트

### 1단계: 코드 업로드
```
Arduino IDE → sketch_sep12a.ino 열기 → 업로드 버튼 클릭
```

### 2단계: 시리얼 모니터 실행
```
Arduino IDE → 도구 → 시리얼 모니터
보레이트: 115200 설정
```

### 3단계: 기본 명령어
```
t   → 영점 조정 (수액 걸기 전)
w   → 초기 무게 측정 (수액 건 후 5초 대기)
s   → 현재 상태 확인 + 센서 안정성 테스트 (5회)
d   → 센서 드리프트 진단 (10초간 연속 측정)
i   → 처방 정보 재요청
q   → 프로그램 종료
```

## 🔬 센서 드리프트 진단 (가장 중요!)

### 명령어: `d`
```
시리얼 모니터에 'd' 입력 + 엔터
```

### 출력 예시
```
🔬 센서 연속 읽기 테스트 (10회, 1초 간격):
시간    무게(g)   변화량
--------------------------------
0s      1112.89   -
1s      1112.67   -0.22
2s      1112.45   -0.22
3s      1112.23   -0.22
4s      1112.01   -0.22
5s      1111.79   -0.22
6s      1111.57   -0.22
7s      1111.35   -0.22
8s      1111.13   -0.22
9s      1111.91   -0.22
10s     1110.69   -0.22

💡 변화량이 ±0.2g 이내면 정상, 계속 감소하면 센서 문제
```

### 결과 판단
| 변화량 (g/초) | 상태 | 조치 |
|--------------|------|------|
| < ±0.2 | ✅ 정상 | 소프트웨어 보정 충분 |
| 0.2 ~ 0.5 | ⚠️ 경미한 드리프트 | 현재 알고리즘으로 대응 가능 |
| > 0.5 | ❌ 하드웨어 문제 | 전원/온도/배선 점검 필요 |

## 🧪 드리프트 자동 보정 테스트

### 테스트 절차
1. `t` - 영점 조정 (수액 없이)
2. 수액 걸기
3. `w` - 초기 무게 측정 (5초 자동 대기)
4. **수액 잠금** (방울 안 떨어지게)
5. 60초 이상 대기
6. 시리얼 모니터 관찰

### 예상 출력
```
[60s] 무게: 1112.5g (잔량: 498.2g, 99.6%) | 유속: 0.15 mL/분 (처방: 2.78, 편차: -94.6%) [60s] | 예상완료: 3321분 후

⚙️ 센서 드리프트 감지 및 보정: 1118.7g → 1112.5g (드리프트: -6.2g)

[61s] 무게: 1112.3g (잔량: 498.0g, 100.0%) | 유속: 0.18 mL/분 (처방: 2.78, 편차: -93.5%) [60s] | 예상완료: 2766분 후
```

### 성공 조건
- ✅ "⚙️ 센서 드리프트 감지 및 보정" 메시지 출력
- ✅ 잔여량 퍼센트가 100%로 재조정
- ✅ 이후 무게 안정화

## 📊 정상 측정 확인

### 테스트 절차
1. `t` → `w` (위와 동일)
2. **수액 정상 투여** (방울 떨어짐)
3. 60초 이상 대기
4. 시리얼 모니터 관찰

### 예상 출력
```
[60s] 무게: 497.2g (잔량: 497.2g, 99.4%) | 유속: 2.80 mL/분 (처방: 2.78, 편차: +0.7%) [60s] | 예상완료: 177분 후
[61s] 무게: 496.8g (잔량: 496.8g, 99.3%) | 유속: 2.78 mL/분 (처방: 2.78, 편차: 0.0%) [60s] | 예상완료: 178분 후
```

### 성공 조건
- ✅ 드리프트 보정 메시지 **나오지 않음**
- ✅ 유속이 처방값 근처
- ✅ 예상 시간이 일정하게 유지

## 🐛 문제 발생 시

### 센서 안정성 문제 (드리프트 > 0.5g/초)
**증상**: 'd' 명령 실행 시 변화량이 0.5g/초 이상

**점검 사항**:
1. 전원 연결 확인 (5V 안정적?)
2. HX711 배선 확인 (DT: D1, SCK: D0)
3. 로드셀 고정 상태 (볼트 조임)
4. 주변 온도 안정적? (ESP8266 발열?)

**임시 해결책**:
- ESP8266 재부팅 (전원 끄고 10초 대기)
- 't' 명령 후 10분 대기 (센서 안정화)

### 드리프트 보정이 너무 자주 발생
**증상**: 정상 투여 중에도 보정 메시지 출력

**원인**: 유속 임계값(0.3 mL/분)이 너무 높음

**해결**: sketch_sep12a.ino 827번 줄 수정
```cpp
if (flowRate >= 0 && flowRate < 0.3 && weight60Full) {  // 0.3을 0.1로 변경
```

### 드리프트 보정이 안 됨
**증상**: 'd' 명령으로 드리프트 확인되는데 보정 안 됨

**원인**: 드리프트 임계값(2g)이 너무 높음

**해결**: sketch_sep12a.ino 837번 줄 수정
```cpp
if (drift > 2.0) {  // 2.0을 1.0으로 변경
```

## 📋 테스트 결과 기록

### 필수 공유 정보
1. `d` 명령 실행 결과 (전체 출력)
2. 드리프트 보정 메시지 캡처
3. 정상 측정 시 시리얼 출력 (1분 이상)

### 공유 방법
시리얼 모니터에서 우클릭 → 복사 → 텍스트 파일로 저장

## 🎯 다음 단계

테스트 완료 후:
1. 드리프트 속도 확인 (d 명령)
2. 자동 보정 동작 확인 (수액 잠금 테스트)
3. 정상 측정 방해 없는지 확인 (정상 투여 테스트)

모든 테스트 통과 시:
- ✅ 알고리즘 안정화 완료
- ✅ 실제 환자 모니터링 준비 완료
- ✅ 백엔드 통합 테스트 진행 가능

## 참고 문서
- [CREEP_COMPENSATION_FIX.md](CREEP_COMPENSATION_FIX.md) - 보정 알고리즘 상세 설명
- [SENSOR_DRIFT_DIAGNOSIS.md](SENSOR_DRIFT_DIAGNOSIS.md) - 드리프트 진단 가이드
- [ESP8266_TEST_GUIDE.md](ESP8266_TEST_GUIDE.md) - 전체 테스트 절차
